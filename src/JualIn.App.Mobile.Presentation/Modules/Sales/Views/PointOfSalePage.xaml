<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="JualIn.App.Mobile.Presentation.Modules.Sales.Views.PointOfSalePage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:controls="clr-namespace:JualIn.App.Mobile.Presentation.UI.Controls"
    xmlns:converters="clr-namespace:JualIn.App.Mobile.Presentation.UI.Controls.Converters"
    xmlns:filtering="clr-namespace:JualIn.App.Mobile.Presentation.UI.Controls.Filtering"
    xmlns:horus="clr-namespace:HorusStudio.Maui.MaterialDesignControls;assembly=HorusStudio.Maui.MaterialDesignControls"
    xmlns:icons="clr-namespace:UraniumUI.Icons.MaterialSymbols;assembly=UraniumUI.Icons.MaterialSymbols"
    xmlns:layouts="clr-namespace:JualIn.App.Mobile.Presentation.Modules.Sales.Views.Layouts"
    xmlns:pages="clr-namespace:JualIn.App.Mobile.Presentation.Modules.Sales.Views"
    xmlns:strings="clr-namespace:JualIn.App.Mobile.Presentation.Resources.Strings"
    xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
    xmlns:vm="clr-namespace:JualIn.App.Mobile.Presentation.Modules.Sales.ViewModels"
    x:Name="root"
    Title="{Static strings:AppStrings.PointOfSalePage_Lbl_PageTitle}"
    x:DataType="{x:Type vm:PointOfSaleViewModel}"
    Shell.TabBarIsVisible="False">
    <ContentPage.Behaviors>
        <toolkit:EventToCommandBehavior
            BindingContext="{Binding Path=BindingContext, Source={x:Reference root}, x:DataType={x:Type pages:PointOfSalePage}}"
            Command="{Binding AppearingCommand}"
            EventName="Appearing" />
        <toolkit:EventToCommandBehavior
            BindingContext="{Binding Path=BindingContext, Source={x:Reference root}, x:DataType={x:Type pages:PointOfSalePage}}"
            Command="{Binding NavigatedToCommand}"
            EventName="NavigatedTo" />
    </ContentPage.Behaviors>

    <Grid>
        <ScrollView Margin="{StaticResource ItemDetailBottomMargin}">
            <VerticalStackLayout
                Margin="{StaticResource AppLayoutPadding}"
                HorizontalOptions="Fill"
                Spacing="{StaticResource CommonSpaceBetweenSmall}">
                <controls:AppSearchBar />

                <FlexLayout
                    horus:MaterialViewGroup.GroupName="CategoryChipsGroup"
                    horus:MaterialViewGroup.SelectedValueChangedCommand="{Binding FilterGroup.SelectedFilterChangeCommand}"
                    horus:MaterialViewGroup.SelectionType="Single"
                    BindableLayout.ItemsSource="{Binding FilterGroup.FilterStates}"
                    Direction="Row"
                    JustifyContent="Start"
                    Wrap="Wrap">
                    <BindableLayout.ItemTemplate>
                        <DataTemplate x:DataType="{x:Type filtering:CountableFilterViewModel`1}">
                            <filtering:CountableFilter
                                Margin="{StaticResource CommonSpaceNanoAll}"
                                BindingContext="{Binding .}"
                                FontSize="{StaticResource FontSizeShrink1}" />
                        </DataTemplate>
                    </BindableLayout.ItemTemplate>
                </FlexLayout>

                <FlexLayout
                    AlignItems="Start"
                    BindableLayout.ItemsSource="{Binding FilterGroup.FilteredItems}"
                    JustifyContent="Start"
                    Wrap="Wrap">
                    <BindableLayout.ItemTemplate>
                        <DataTemplate>
                            <layouts:SaleProductView Margin="{StaticResource CommonSpaceNanoAll}" />
                        </DataTemplate>
                    </BindableLayout.ItemTemplate>
                    <BindableLayout.EmptyView>
                        <horus:MaterialLabel Text="No products data" />
                    </BindableLayout.EmptyView>
                </FlexLayout>

                <horus:MaterialProgressIndicator IsVisible="{Binding IsRefreshing}" />
            </VerticalStackLayout>
        </ScrollView>

        <Grid
            Margin="{StaticResource CommonSpaceMediumAll}"
            HorizontalOptions="Fill"
            IsVisible="{Binding HasProductSelected}"
            VerticalOptions="End">
            <horus:MaterialButton Command="{Binding CheckoutCommand}" />

            <Grid
                Padding="{StaticResource CommonSpaceLargeX}"
                ColumnDefinitions="auto,*,auto,auto"
                ColumnSpacing="{StaticResource CommonSpaceBetweenSmall}"
                HorizontalOptions="Fill"
                VerticalOptions="Center">
                <Image
                    Grid.Column="0"
                    Source="{FontImageSource FontFamily=MaterialRounded,
                                             Glyph={Static icons:MaterialRounded.Shopping_cart_checkout},
                                             Size={StaticResource IconSizeSmall},
                                             Color={AppThemeBinding Light={StaticResource OnPrimary},
                                                                    Dark={StaticResource DarkOnPrimary}}}"
                    VerticalOptions="Center" />
                <horus:MaterialLabel
                    Grid.Column="1"
                    HorizontalOptions="Fill"
                    HorizontalTextAlignment="Start"
                    Text="{Static strings:AppStrings.PointOfSalePage_Btn_Checkout}"
                    TextColor="{AppThemeBinding Light={StaticResource OnPrimary},
                                                Dark={StaticResource DarkOnPrimary}}"
                    VerticalTextAlignment="Center" />
                <horus:MaterialLabel
                    Grid.Column="2"
                    HorizontalTextAlignment="End"
                    TextColor="{AppThemeBinding Light={StaticResource OnPrimary},
                                                Dark={StaticResource DarkOnPrimary}}"
                    Type="LabelMedium"
                    VerticalTextAlignment="Center">
                    <horus:MaterialLabel.Text>
                        <MultiBinding StringFormat="{}{0} {1}">
                            <Binding FallbackValue="0" Path="OnCartTotalQuantity" />
                            <Binding Source="{Static strings:AppStrings.Common_Lbl_Items_Postfix}" />
                        </MultiBinding>
                    </horus:MaterialLabel.Text>
                </horus:MaterialLabel>
                <horus:MaterialLabel
                    Grid.Column="3"
                    FontAttributes="Bold"
                    HorizontalTextAlignment="End"
                    Text="{Binding OnCartTotalPrice, FallbackValue=0, StringFormat='{}{0:C0}'}"
                    TextColor="{AppThemeBinding Light={StaticResource OnPrimary},
                                                Dark={StaticResource DarkOnPrimary}}"
                    VerticalTextAlignment="Center" />
            </Grid>
        </Grid>
    </Grid>
</ContentPage>